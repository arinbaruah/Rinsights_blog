{
  "hash": "2b015c69bf0603b4c7f1d9462a6593aa",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Bringing Key Trends to Light Using gghighlight in ggplot2 🧐\"\nauthor: \"Arindam Baruah\"\nformat:\n  html:\n    code-fold: true\ndate: \"2024-11-27\"\ncategories: [R,data cleaning,exploratory data analysis,plot aesthetics,gghighlight, ggplot2]\nquarto-required: \">=1.3.0\"\nexecute: \n  warning: false\n  message: false\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n\n# Introduction\n\nThis edition highlights the annual number of border encounters handled by U.S. Customs and Border Protection (CBP), exploring the intriguing demographic trends revealed by the data. The key focus of the visualisation was to use the \"gghighlight\" package, which allowed me to compare the trends of every country in each facet panel as a greyed-out line.\n\n\n# Libraries used\n\nThe list of R packages used for creating this visualisation 👇\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(stringr)\nlibrary(glue)\nlibrary(ggrepel)\nlibrary(ggplot2)\nlibrary(ggtext)\nlibrary(sysfonts)\nlibrary(showtext)\nlibrary(ggbump)\nlibrary(gghighlight)\nlibrary(MetBrewer)\n```\n:::\n\n\n\n\n\n# Sourcing the data\n\nThe dataset is obtained from the [TidyTuesday repository](https://github.com/rfordatascience/tidytuesday/blob/master/data/2024/2024-11-26/readme.md).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncbp_resp <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2024/2024-11-26/cbp_resp.csv')\ncbp_state <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2024/2024-11-26/cbp_state.csv')\n```\n:::\n\n\n\n\n# Setting the plot aesthetics\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# caption handles\nswd <- str_glue(\"#SWDchallenge: June 2024 &bull; Source: Synthetic data from ChatGPT<br>\")  \nli <- str_glue(\"<span style='font-family:fa6-brands'>&#xf08c;</span>\")  \ngh <- str_glue(\"<span style='font-family:fa6-brands'>&#xf09b;</span>\")\nmn <- str_glue(\"<span style='font-family:fa6-brands'>&#xf4f6;</span>\")\ntt <- str_glue(\"#TidyTuesdayR: November 2024 &bull; Source: US Customs and Border Protection (CBP) <br>\") \n\n# plot colors\nbkg_col      <- colorspace::lighten(\"white\", 0.05)    \ntitle_col    <- \"#3d3d3d\"           \nsubtitle_col <- \"#3d3d3d\"     \ncaption_col  <- \"#72647D\"   \ntext_col     <- colorspace::darken(\"gray40\" , 0.2)  \n\n# fonts\n\nfont_add('fa6-brands','fontawesome/otfs/Font Awesome 6 Brands-Regular-400.otf') \nfont_add_google(\"Roboto\", regular.wt = 400, family = \"title\")                 \nfont_add_google(\"Alegreya\", regular.wt = 400, family = \"subtitle\")  \nfont_add_google(\"Quattrocento Sans\", regular.wt = 400, family = \"text\")        \nfont_add_google(\"Merriweather\", regular.wt = 400,family = \"caption\")\nshowtext_auto(enable = TRUE)  \n\n# Plot texts\n\ntitle_text <- \"<span style='color:darkred'>US authorities recording high border encounters <br> across nationalities (2020-2024)</span>\"\n\n\nsubtitle_text <- \"The U.S. Customs and Border Protection (CBP) has been handling an average of approximately 178,000 encounters per month with individuals of <br> various nationalities at the U.S. borders. A chart highlighting the top 10 citizenships of inadmissible individuals at the southern and northern <br> borders reveals that <span style='color:steelblue'>Mexican</span> nationals remain the most frequently encountered. However, this marks the second consecutive decline in encounters <br> involving Mexican citizens. While the numbers for most other nationalities have remained relatively stable, there has been a <strong> significant rise in <br> encounters </strong> with individuals from <span style='color:#cc5200'><strong>Haiti</strong></span> and <span style='color:#004d00'><strong>Venezuela</strong></span>, who were either apprehended for unauthorized border crossings or deemed inadmissible.  \"\n\n\nX_icon <- glue(\"<span style='font-family:fa6-brands'>&#xe61b;</span>\")\n\ncaption_text <- str_glue(\"{li} Arindam Baruah | {X_icon} @wizsights | {gh} arinbaruah | Source: US Customs and Border Patrol| #TidyTuesdayR #rstudio #gghighlight #ggplot2\")\n\ntheme_set(theme_minimal(base_size = 15, base_family = \"text\"))                \n\n# Theme updates\n\ntheme_update(\n  plot.title.position   = \"plot\",\n  plot.caption.position = \"plot\",\n  legend.position       = 'plot',\n  plot.margin           = margin(t = 10, r = 15, b = 0, l = 15),\n  plot.background       = element_rect(fill = bkg_col, color = bkg_col),\n  panel.background      = element_rect(fill = bkg_col, color = bkg_col),\n  axis.title.x          = element_text(margin = margin(10, 0, 0, 0), size = rel(1), color = text_col, family = 'text', face = 'bold'),\n  axis.title.y          = element_text(margin = margin(0, 10, 0, 0), size = rel(1), color = text_col, family = 'text', face = 'bold'),\n  axis.text             = element_text(size = 10, color = text_col, family = 'text',face = \"bold\"),\n  panel.grid.minor.y    = element_blank(),\n  panel.grid.major.y    = element_line(linetype = \"dotted\", linewidth = 0.1, color = 'gray40'),\n  panel.grid.minor.x    = element_blank(),\n  panel.grid.major.x    = element_blank(),\n  axis.line.x           = element_line(color = \"#d7d7d8\", linewidth = .2),\n)\n```\n:::\n\n\n\n\n# Data wrangling\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_countries_grouped <- cbp_resp %>% filter(citizenship != \"OTHER\") %>% \n  group_by(citizenship) %>% summarise(total = sum(encounter_count/10^3)) %>% \n  arrange(-total) %>% head(10)\n\ntop_countries <- top_countries_grouped$citizenship\n\ntop_countries_grouped <- cbp_resp %>% filter(citizenship != \"OTHER\" & citizenship %in% top_countries) %>% \n  group_by(fiscal_year,citizenship) %>% summarise(total = sum(encounter_count/10^3)) %>% \n  arrange(-total)\n\ntop_countries_grouped$citizenship <- factor(top_countries_grouped$citizenship,levels = top_countries)\n```\n:::\n\n\n\n\n# Data Visualisation\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsubtitle_text <- \"The U.S. Customs and Border Protection (CBP) has been handling an average of <strong>approximately 178,000 encounters annually </strong> with individuals of  various nationalities at the U.S. borders. <br> A chart highlighting the top 10 citizenships of inadmissible individuals at the southern and northern borders reveals that <span style='color:steelblue'><strong>Mexican</strong></span> nationals remain the most frequently encountered. <br> However, this marks the second consecutive decline in encounters  involving Mexican citizens. While the numbers for most other nationalities have remained relatively stable, there has <br> been a <strong> significant rise in encounters </strong> with individuals from <span style='color:#cc5200'><strong>Haiti</strong></span> and <span style='color:#004d00'><strong>Venezuela</strong></span>, who were either apprehended for unauthorized border crossings or deemed inadmissible.  \"\n\npl1 <- ggplot(data = top_countries_grouped) +\n    geom_hline(aes(yintercept = mean(total)),linetype=\"solid\", size=.25) +\n    geom_point(data= top_countries_grouped %>% \n               group_by(citizenship) %>% \n               slice_max(fiscal_year),\n             aes(x=fiscal_year, y=total, color=citizenship),shape=16) +\n  geom_line(aes(x=fiscal_year, y=total, color=citizenship)) +\n  gghighlight(use_direct_label = FALSE,\n              unhighlighted_params = list(colour = alpha(\"grey85\", 1))) +\n  geom_text(data=top_countries_grouped %>% \n               group_by(citizenship) %>% \n               slice_max(fiscal_year),\n             aes(x=fiscal_year, y=total, color= citizenship, label = round(total)),\n             hjust = 1.5, vjust = -1.5, size=6, fontface=\"bold\") +\n  facet_wrap(~factor(citizenship,levels = top_countries),nrow = 2) +\n  labs(title = title_text,\n       subtitle = subtitle_text,\n       caption = caption_text,\n       x = \"Fiscal year\",\n       y = \"Total number of encounters (in 1000s)\") +\n    scale_color_met_d(name=\"Redon\") + theme_minimal() +\n    theme(legend.position = \"none\",\n        panel.spacing = unit(3, \"lines\"),\n        panel.grid.minor = element_blank(),\n        panel.grid.major.y = element_blank(),\n        panel.grid.major.x = element_line(linewidth = .3, linetype = \"dashed\", color = \"grey50\"),\n        plot.margin = margin(20, 20, 20, 20),\n    legend.title.position = \"top\",\n    legend.title = element_text(\n      color = text_col,\n      hjust = 0.5,\n      family = \"text\",\n      face = \"bold\",\n      size = rel(3),\n    ),\n    legend.text = element_markdown(\n      color = text_col,\n      family = \"text\",\n      size = rel(2),\n      face = \"bold\"\n    ),\n    plot.title            = element_markdown(\n      size                = rel(4),\n      family              = \"title\",\n      face                = \"bold\",\n      color               = title_col,\n      lineheight          = 0.5,\n      margin              = margin(t = 5, b = 5),\n      hjust               = 0.5\n    ),        \n    plot.subtitle         = element_markdown(\n      size                = rel(2), \n      family              = 'subtitle',\n      color               = subtitle_col,\n      hjust               = 0,\n      lineheight          = 0.5, \n      margin              = margin(t = 5, b = 1)\n    ),\n      plot.caption          = element_markdown(\n      size                = rel(1.5), \n      family              = 'caption',\n      color               = caption_col,\n      lineheight          = 0.3,\n      hjust               = 0.5,\n      halign              = 0,\n      margin              = margin(t = 10, b = 10)\n    ),\n    strip.text = element_markdown(\n      size                = rel(1.5),\n      family              = 'text',\n      face                = \"bold\"   \n    ),\n    axis.title = element_markdown(\n      size                = rel(2),\n      family              = \"text\"\n    ),\n    axis.text.y  = element_markdown(\n      size = rel(2),\n      face = \"bold\"\n    ),\n    axis.text.x = element_markdown(\n      size = rel(2),\n      face = \"bold\"\n    )\n  ) \n  \n\nggsave(\"US_Border_encounter.jpeg\",plot = pl1,width =8, height = 5)\n```\n:::\n\n\n\n\n# Final plot\n\n![\"US Border encounters across nationalities\"](US_Border_encounter.jpeg){#fig-finalplot}\n\n:::{.callout-note}\n# Key insights\n\n1. The average number of annual encounters at the US border is 178K individuals. 💡\n2. Mexican nationals are the single largest source of border encounters at the US border, with the most recent numbers amounting to 668K individuals. 😱\n3. Significant rise in the number of border encounters from Haiti and Venezuela was observed. 🤔\n4. Numbers for the other countries have remained relative stable over the past years.🧐\n\n:::\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}