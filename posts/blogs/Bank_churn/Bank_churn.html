<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Arindam Baruah">

<title>Bank account churn classification</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Bank_churn_files/libs/clipboard/clipboard.min.js"></script>
<script src="Bank_churn_files/libs/quarto-html/quarto.js"></script>
<script src="Bank_churn_files/libs/quarto-html/popper.min.js"></script>
<script src="Bank_churn_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Bank_churn_files/libs/quarto-html/anchor.min.js"></script>
<link href="Bank_churn_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Bank_churn_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Bank_churn_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Bank_churn_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Bank_churn_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="Bank_churn_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="Bank_churn_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-intro" id="toc-sec-intro" class="nav-link active" data-scroll-target="#sec-intro"><span class="header-section-number">1</span> What is a bank churn and why does it occur ?</a></li>
  <li><a href="#importing-the-relevant-libraries-and-dataset" id="toc-importing-the-relevant-libraries-and-dataset" class="nav-link" data-scroll-target="#importing-the-relevant-libraries-and-dataset"><span class="header-section-number">2</span> Importing the relevant libraries and dataset</a></li>
  <li><a href="#data-description" id="toc-data-description" class="nav-link" data-scroll-target="#data-description"><span class="header-section-number">3</span> Data description</a></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning"><span class="header-section-number">4</span> Data cleaning</a></li>
  <li><a href="#data-sanity-checks" id="toc-data-sanity-checks" class="nav-link" data-scroll-target="#data-sanity-checks"><span class="header-section-number">5</span> Data sanity checks</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis"><span class="header-section-number">6</span> Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#correlation-plot" id="toc-correlation-plot" class="nav-link" data-scroll-target="#correlation-plot"><span class="header-section-number">6.1</span> Correlation plot</a></li>
  <li><a href="#geography-wise-churn" id="toc-geography-wise-churn" class="nav-link" data-scroll-target="#geography-wise-churn"><span class="header-section-number">6.2</span> Geography wise churn</a></li>
  <li><a href="#age-wise-bank-churn" id="toc-age-wise-bank-churn" class="nav-link" data-scroll-target="#age-wise-bank-churn"><span class="header-section-number">6.3</span> Age wise bank churn</a></li>
  <li><a href="#credit-score-wise-churn" id="toc-credit-score-wise-churn" class="nav-link" data-scroll-target="#credit-score-wise-churn"><span class="header-section-number">6.4</span> Credit score wise churn</a></li>
  <li><a href="#transaction-activity-wise-churn" id="toc-transaction-activity-wise-churn" class="nav-link" data-scroll-target="#transaction-activity-wise-churn"><span class="header-section-number">6.5</span> Transaction activity wise churn</a></li>
  <li><a href="#balance-wise-churn" id="toc-balance-wise-churn" class="nav-link" data-scroll-target="#balance-wise-churn"><span class="header-section-number">6.6</span> Balance wise churn</a></li>
  </ul></li>
  <li><a href="#model-creation" id="toc-model-creation" class="nav-link" data-scroll-target="#model-creation"><span class="header-section-number">7</span> Model creation</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bank account churn classification</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Arindam Baruah </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>üè¶ üí∏</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figure/fig1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Source: Medium</figcaption>
</figure>
</div>
<section id="sec-intro" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> What is a bank churn and why does it occur ?</h1>
<p>With the advent of digital banking, it has become extremely convenient for users to open a new bank account. As opposed to the age old tradition of submitting multiple documents and credit histories after visiting a bank, the process has been revamped by a great deal with an user needing less than 10 minutes to open an account in the comfort of their couches.</p>
<p>However, with digital banking, it has also become convenient for users to close a bank account, more commonly termed as a <strong>‚Äúchurn‚Äù</strong>. While this may appear to be a win for consumers, it is however important to understand the reasons and the effects that entail from a bank churn.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reasons for a churn to occur
</div>
</div>
<div class="callout-body-container callout-body">
<p>A bank account churn could occur for a multitiude of reasons which are important for banks to analyse to reduce attrition of customers and also remain competitive in the market. Some of the reasons are:</p>
<ul>
<li><strong>Fees and Charges:</strong> High fees or unexpected charges can prompt customers to switch banks. This may include monthly maintenance fees, ATM fees, overdraft fees, and other charges.</li>
<li><strong>Low Interest Rates:</strong> If a bank offers low interest rates on savings accounts or certificates of deposit, customers might look for better opportunities elsewhere to maximize their returns.</li>
<li><strong>Poor Customer Service:</strong> Inadequate customer service, long wait times, and unhelpful staff can lead to frustration and dissatisfaction, prompting customers to seek better service elsewhere.</li>
<li><strong>Branch Accessibility:</strong> Limited access to physical branches or ATMs can be a significant factor. If a customer moves to an area where their current bank has limited presence, they might switch to a more accessible option.</li>
<li><strong>Technology and Online Services:</strong> Customers may switch to a bank that provides better online and mobile banking services, as technology plays an increasingly crucial role in the banking experience.</li>
<li><strong>Incentives and Promotions:</strong> Banks often attract new customers by offering promotions, bonuses, or better interest rates. Existing customers may churn to take advantage of these offers.</li>
<li><strong>Changes in Financial Needs:</strong> As individuals‚Äô financial situations evolve, their banking needs may change. For example, a customer might require more advanced financial products, and if their current bank can‚Äôt meet those needs, they may switch to a different institution.</li>
<li><strong>Mergers and Acquisitions:</strong> Changes resulting from bank mergers or acquisitions, such as alterations in account terms, fees, or service quality, can drive customers to seek alternatives.</li>
<li><strong>Ethical or Social Reasons:</strong> Some customers may choose to switch banks due to concerns about a bank‚Äôs ethical practices, social responsibility, or involvement in controversial activities.</li>
<li><strong>Security Concerns:</strong> If a bank experiences a security breach or if customers perceive their accounts to be at risk, they may opt to move their funds to a more secure institution.</li>
<li><strong>Better Financial Products:</strong> Customers may switch banks to access better financial products, such as higher-interest savings accounts, more competitive loan rates, or improved credit card offerings.</li>
<li><strong>Life Events:</strong> Major life events like marriage, divorce, retirement, or the death of a spouse can prompt individuals to reassess their banking relationships and switch to better-suited options.</li>
</ul>
</div>
</div>
</section>
<section id="importing-the-relevant-libraries-and-dataset" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Importing the relevant libraries and dataset</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Packages used</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Dataset glimpse</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>In order to initiate our analysis of the bank account data, we will read all the required libraries and then take a glimpse of how our data looks like.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bookdown)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringi)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mltools)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visdat)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caTools)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pscl)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lightgbm)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(catboost)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="cell-output-display">
<div id="tbl-data" class="anchored">
<table class="lightable-paper table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;1: Bank churn dataset</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CustomerId</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Surname</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CreditScore</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Geography</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Gender</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Age</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tenure</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Balance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">NumOfProducts</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">HasCrCard</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">IsActiveMember</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">EstimatedSalary</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Exited</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right; width: 30em; background-color: yellow !important;">15674932</td>
<td style="text-align: left;">Okwudilichukwu</td>
<td style="text-align: right;">668</td>
<td style="text-align: left;">France</td>
<td style="text-align: left;">Male</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">181449.97</td>
<td style="text-align: right; font-weight: bold; border-right: 1px solid;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right; width: 30em; background-color: yellow !important;">15749177</td>
<td style="text-align: left;">Okwudiliolisa</td>
<td style="text-align: right;">627</td>
<td style="text-align: left;">France</td>
<td style="text-align: left;">Male</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">49503.50</td>
<td style="text-align: right; font-weight: bold; border-right: 1px solid;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right; width: 30em; background-color: yellow !important;">15694510</td>
<td style="text-align: left;">Hsueh</td>
<td style="text-align: right;">678</td>
<td style="text-align: left;">France</td>
<td style="text-align: left;">Male</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">184866.69</td>
<td style="text-align: right; font-weight: bold; border-right: 1px solid;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right; width: 30em; background-color: yellow !important;">15741417</td>
<td style="text-align: left;">Kao</td>
<td style="text-align: right;">581</td>
<td style="text-align: left;">France</td>
<td style="text-align: left;">Male</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">148882.5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">84560.88</td>
<td style="text-align: right; font-weight: bold; border-right: 1px solid;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right; width: 30em; background-color: yellow !important;">15766172</td>
<td style="text-align: left;">Chiemenam</td>
<td style="text-align: right;">716</td>
<td style="text-align: left;">Spain</td>
<td style="text-align: left;">Male</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15068.83</td>
<td style="text-align: right; font-weight: bold; border-right: 1px solid;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right; width: 30em; background-color: yellow !important;">15771669</td>
<td style="text-align: left;">Genovese</td>
<td style="text-align: right;">588</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Male</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">131778.6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">136024.31</td>
<td style="text-align: right; font-weight: bold; border-right: 1px solid;">1</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
</div>
</div>
</section>
<section id="data-description" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data description</h1>
<p>Based on a brief research, the description for each variable in the dataset is as follows:</p>
<ol type="1">
<li><strong>CustomerId:</strong> Unique identifier for each customer</li>
<li><strong>Surname:</strong> Name associated with the customer</li>
<li><strong>CreditScore:</strong> Credit score of the customer</li>
<li><strong>Geography:</strong> Location of the bank account based on geographical location of the bank</li>
<li><strong>Gender:</strong> Gender of the customer</li>
<li><strong>Age:</strong> Current age of the customer</li>
<li><strong>Tenure:</strong> Length of time since the opening of the bank account</li>
<li><strong>Balance:</strong> Current credit balance in the account</li>
<li><strong>NumOfProducts:</strong> Number of banking services used by the customer</li>
<li><strong>HasCrCard:</strong> An indicator for whether the customer has a credit card</li>
<li><strong>IsActiveMember:</strong> Is the customer a regular user of the bank account through transactions</li>
<li><strong>EstimatedSalary:</strong> Estimated earning declared as salary for the customer</li>
<li><strong>Exited:</strong> Has the customer closed the bank account</li>
</ol>
</section>
<section id="data-cleaning" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Data cleaning</h1>
<div class="cell">
<div class="cell-output-display">
<div id="fig-misvis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-misvis-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Check for missing values in the dataset</figcaption>
</figure>
</div>
</div>
</div>
<p>As we can observe from <a href="#fig-misvis">Figure&nbsp;1</a>, the dataset is clean and <strong>does not have any missing values to be dealt with.</strong> While this is ideal, it is however not the only check that we must perform in the data.</p>
</section>
<section id="data-sanity-checks" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Data sanity checks</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">CustomerId</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Estimated Salary</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Age</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>Since the customer ID is a unique identification reference number for</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-occur" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;2: Number of occurrences of each customer</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">CustomerId</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total_occurrences</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">15682355</td>
<td style="text-align: right;">121</td>
</tr>
<tr class="even">
<td style="text-align: right;">15570194</td>
<td style="text-align: right;">99</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15585835</td>
<td style="text-align: right;">98</td>
</tr>
<tr class="even">
<td style="text-align: right;">15595588</td>
<td style="text-align: right;">91</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15648067</td>
<td style="text-align: right;">90</td>
</tr>
<tr class="even">
<td style="text-align: right;">15793331</td>
<td style="text-align: right;">90</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Based on <a href="#tbl-occur">Table&nbsp;2</a>, we can observe that the same customer ID appears multiple number of times in the dataset when infact, it was supposed to appear just once. Hence, we can consider the CustomerId variable to be serving no purpose in the current dataset. This shall be dropped in the feature selection section.</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>The estimated salary variable indicates the income of each customer declared as a salary. <strong>Salaries can never be negative.</strong> Let us quickly check if that indeed is the case.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-salary" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-salary-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Salary distribution of customers</figcaption>
</figure>
</div>
</div>
</div>
<p>Based on the histrogram of the salaries as illustrated by <a href="#fig-salary">Figure&nbsp;2</a>, we can observe that the salaries are <strong>indeed positive which is what is expected.</strong></p>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>Bank account customers are generally required to be adults (&gt; 18 years). We will check if that holds true for the current dataset and attempt to detect any anomalous data such as negative age.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-age" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-age-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Age distribution of the bank customers</figcaption>
</figure>
</div>
</div>
</div>
<p>Based on <a href="#fig-age">Figure&nbsp;3</a>, we can observe that the data indeed suggests that the customers are of the right age (&gt;18 years) and there are no anomalous data entries for this variable.</p>
</div>
</div>
</div>
</section>
<section id="exploratory-data-analysis" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Exploratory Data Analysis</h1>
<p>Before we create a prediction model, we need to understand how are our variables correlated to one another. This will be done through various visualisations as follows:</p>
<section id="correlation-plot" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="correlation-plot"><span class="header-section-number">6.1</span> Correlation plot</h2>
<div class="cell">
<div class="cell-output-display">
<div id="fig-corrplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-corrplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Correlation plot</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p>Based on our understanding of the variables as illustrated by the correlation plot in <a href="#fig-corrplot">Figure&nbsp;4</a>, we can infer that there is <strong>no single variable which is highly correlated</strong> to the churn indicator. <strong>We can also observe that none of the features are highly correlated to one another. This indicates that there is no multicollinearity in the choice of our features.</strong></p>
</div>
</div>
</section>
<section id="geography-wise-churn" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="geography-wise-churn"><span class="header-section-number">6.2</span> Geography wise churn</h2>
<p>Let us try to understand if there are any geographical regions which have accounted for high churns.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-geo" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-geo-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5: Bank accounts for each geographical location</figcaption>
</figure>
</div>
</div>
</div>
<p>Based on the illustration <a href="#fig-geo">Figure&nbsp;5</a>, we can observe that the percentage of churns are significantly higher in Germany as compared to France and Spain where the churn percentage appears to be similar.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p>The higher churn % for Germany could indicate issues pertaining to the economy of the country or factors such as loan interest rate in the country. It could also indicate that the banking services or customer services in Germany might be lacking as compared to the other countries which have resulted in the higher churn percentage. Diving deeper into the banking practices of Germany would provide a better understanding as to the reason for the high attrition of customers.</p>
</div>
</div>
</section>
<section id="age-wise-bank-churn" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="age-wise-bank-churn"><span class="header-section-number">6.3</span> Age wise bank churn</h2>
<div class="cell">
<div class="cell-output-display">
<div id="fig-age-churn" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-age-churn-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Age wise churn data</figcaption>
</figure>
</div>
</div>
</div>
<p>As we can observe through <a href="#fig-age-churn">Figure&nbsp;6</a>, the churns are associated majorly with customers between the ages of 25 and 60.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p>The data indicates that after a couple of years since opening a new bank account, customers are observed to close their accounts which could be due to numerous reasons such as:</p>
<ol type="1">
<li>Better customer services from other banks</li>
<li>Low credit score or due to financial bankruptcy of the customer</li>
<li>High loan interests charged by the bank which may have led the customer to switch to another bank after fulfilling the loan.</li>
</ol>
</div>
</div>
</section>
<section id="credit-score-wise-churn" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="credit-score-wise-churn"><span class="header-section-number">6.4</span> Credit score wise churn</h2>
<p>Let us now try to analyse if the credit scores could tell us anything about the likelihood of the bank account churns.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-cred" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-cred-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;7: Credit score distribution of churned accounts</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p>Based on the credit score distribution of the churned and active accounts as illustrated in <a href="#fig-cred">Figure&nbsp;7</a>, we <strong>cannot observe any discernible difference in the credit scores which could indicate the likeliness of a bank account churn</strong>. This indicates that the credit scores of customers may not be a strong factor leading to them closing their bank accounts.</p>
</div>
</div>
</section>
<section id="transaction-activity-wise-churn" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="transaction-activity-wise-churn"><span class="header-section-number">6.5</span> Transaction activity wise churn</h2>
<p>Next, we can analyse if the churns are mostly from bank accounts which are inactive, possibly due to very low transactions.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-transact" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-transact-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;8: Transaction activity wise churn</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p>Based on <a href="#fig-transact">Figure&nbsp;8</a>, we can observe that the percentage of the <strong>bank churns for inactive accounts are more than twice that of the active accounts.</strong></p>
<p>This indicates that the probability of a churn rises if the transaction activity of the bank account reduces. This could also be measure taken by the bank to reduce the burden of keeping the services activated for accounts which have shown little to no activity for an extended period of duraiton.</p>
</div>
</div>
</section>
<section id="balance-wise-churn" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="balance-wise-churn"><span class="header-section-number">6.6</span> Balance wise churn</h2>
<p>Let us try to analyse if the account balance can indicate whether a churn might take place.</p>
<p>For this, we will flag any balance which is 0.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-balance" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-balance-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;9: Account balance wise churn</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="#fig-balance">Figure&nbsp;9</a> illustrates the percentage of bank accounts churned for accounts with positive balance and zero balance. Contrary to belief, the percentage of churns are actually higher for accounts with positive balance as compared to zero balance accounts.</p>
<p>This could be due to the fact that account holders with zero balances are generally inactive and may not proactively close their accounts but rather, is done so by the bank to reduce the maintenance cost of keeping zero balance accounts active. However, account holders with positive balance may proactively choose to close their accounts due to various reasons as stated in <a href="#sec-intro">Section&nbsp;1</a> which may lead to the higher percentage of churned accounts.</p>
</div>
</div>
</section>
</section>
<section id="model-creation" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Model creation</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">Logistic Regression</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">XGboost classifier</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">Light GBM</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false" href="">Catboost classifier</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>Here, we will fit the logistic regression model to the train data as follows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>model_logit <span class="ot">&lt;-</span> <span class="fu">glm</span>(Exited<span class="sc">~</span>.,<span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">'logit'</span>),<span class="at">data=</span>train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us study the performance of the logistic regression model through the Receiver Operating Curve (ROC) metric.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-roclog" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-roclog-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;10: ROC-AUC metric</figcaption>
</figure>
</div>
</div>
</div>
<p>Based on the receiver operating curve as illustrated by <a href="#fig-roclog">Figure&nbsp;10</a>, we can observe that while a sizeable are of the graph is covered by the curve, it can however by improved by possibly a better classification algorithm.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-conflog" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-conflog-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;11: Confusion matrix for Logistic Regression classification model</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-conflog">Figure&nbsp;11</a> depicts a more intuitive way to understand the performance of the Logistic Regression. The model was able to predict the churned accounts with an <strong>accuracy of 83.4%</strong>.</p>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>Let us try to use an extra gradient boosted ensemble method commonly termed as the XGboost classifier.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-logloss:0.430351 
[2] train-logloss:0.381727 </code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-confxgb" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-confxgb-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;12: Confusion matrix for XGBoost classification model</figcaption>
</figure>
</div>
</div>
</div>
<p>We observe a marginally <strong>better classification accuracy as compared to the logistic regression model for the XGboosted classifier as depicted by <a href="#fig-confxgb">Figure&nbsp;12</a> with an accuracy of 85.1%.</strong></p>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>Let us utilise the LGBM algorithm and train it on the given dataset.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-lgbconf" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-lgbconf-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;13: Confusion matrix for Light GBM classification model</figcaption>
</figure>
</div>
</div>
</div>
<p>Based on <a href="#fig-lgbconf">Figure&nbsp;13</a>, we can observe that the LGB classifier has actually classified poorly with multiple negatives observed in its classification. We can disregard this model for our purpose of classification.</p>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-catimp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-catimp-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;14: Importance of each variable based on the Catboost classification algorithm</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-catconf" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Bank_churn_files/figure-html/fig-catconf-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;15: Confusion matrix for Catboost classification model</figcaption>
</figure>
</div>
</div>
</div>
<p>Upon utilising the Catboost classifier, we can observe from <a href="#fig-catconf">Figure&nbsp;15</a> that the classifier <strong>has a marginally better accuracy when compared to the logistic regression, XGboost and Light GBM.</strong></p>
<p>Additionally, <a href="#fig-catimp">Figure&nbsp;14</a> indicates the variables which have the highest importance in predicting the bank account churns. We can observe that the variables, ‚ÄúNumber of products‚Äù followed by ‚ÄúAge‚Äù and ‚ÄúActivity‚Äù are the most critical to be able to predict tge churned accounts.</p>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>